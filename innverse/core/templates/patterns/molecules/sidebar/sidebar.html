{% load static %}
<nav class="bg-bg-secondary relative top-0 flex flex-col font-heading justify-between p-4 text-text-primary">
    <button id="nav-fold-btn" class="absolute top-0 right-0 noscript:hidden">
        <svg class="feather nav-icon !size-7"><use href="{% static 'icons/feather-sprite.svg#chevron-left' %}" /></svg>
    </button>
    <ul class="flex flex-col gap-2 text-4xl uppercase">
        {% include "atoms/sidebar_nav/sidebar_nav_element.html" with title="Overview" feather_icon="home" target_href="/" %}
        {% include "atoms/sidebar_nav/sidebar_nav_element.html" with title="Characters" feather_icon="users" target_href="/characters" %}
        {% include "atoms/sidebar_nav/sidebar_nav_element.html" with title="Classes" feather_icon="star" target_href="/classes" %}
        {% include "atoms/sidebar_nav/sidebar_nav_element.html" with title="Skills" feather_icon="award" target_href="/skills" %}
        {% include "atoms/sidebar_nav/sidebar_nav_element.html" with title="Magic" feather_icon="feather" target_href="/magic" %}
        {% include "atoms/sidebar_nav/sidebar_nav_element.html" with title="Locations" feather_icon="map" target_href="/locations" %}
        {% include "atoms/sidebar_nav/sidebar_nav_element.html" with title="Search" feather_icon="search" target_href="/search" %}
    </ul>
    <ul class="bg-bg-tertiary flex flex-col p-2 rounded-xl text-hl-tertiary text-3xl capitalize">
        {% include "atoms/sidebar_nav/sidebar_nav_element.html" with title="Code" feather_icon="github" target_href="https://github.com/cblanken/wandering-inn-stats" new_tab=True %}
        {% include "atoms/sidebar_nav/sidebar_nav_element.html" with title="About" feather_icon="info" target_href="/about" %}
    </ul>
</nav>
<script>
    let nav = document.querySelector("nav");
    let nav_titles = document.querySelectorAll(".nav-title")

    function fold_nav() {
        nav.classList.add("w-24");
        nav_titles.forEach(title => {
            title.classList.add("hidden");
        })

        nav_groups = document.querySelectorAll("nav > ul")
        nav_groups.forEach(group => {
            group.classList.add("items-center");
        })

        let nav_fold_btn = document.querySelector("#nav-fold-btn")
        nav_fold_btn.classList.add("animate-flip-icon");
    }

    function unfold_nav() {
        nav.classList.remove("w-24")
        nav_titles.forEach(title => {
            title.classList.remove("hidden");
        })

        nav_groups = document.querySelectorAll("nav > ul")
        nav_groups.forEach(group => {
            group.classList.remove("items-center");
        })

        let nav_fold_btn = document.querySelector("#nav-fold-btn")
        nav_fold_btn.classList.remove("animate-flip-icon");
    }

    // Fold per setting in localStorage
    let is_nav_folded = localStorage.getItem("nav_folded");
    if (is_nav_folded === "true") {
        fold_nav()
    }

    // Add fold click event
    let nav_fold_btn = document.querySelector("#nav-fold-btn")
    nav_fold_btn.addEventListener("click", (e) => {
        if (localStorage.getItem("nav_folded") === "true") {
            localStorage.setItem("nav_folded", false);
            unfold_nav()
        } else {
            localStorage.setItem("nav_folded", true);
            fold_nav()
        }
        window.dispatchEvent(new Event('resize'));
    })
</script>
