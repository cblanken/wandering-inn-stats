{% load django_tables2 i18n l10n static %}
{% block table_wrapper %}
<div class="table-body-container w-full min-h-screen flex flex-col">
  {% block pagination %}
    {% if table.page and table.paginator.num_pages > 1 %}
    {% include "tables/table_pagination.html" with table_page_range=table_page_range %}
    {% endif %}
  {% endblock pagination %}
  {% block table %}
  <table class="border-collapse border-spacing-2 block overflow-x-scroll lg:table-auto lg:overflow-auto">
    {% block table.thead %}
    {% if table.show_header %}
        <thead class="text-hl-tertiary text-xl bg-bg-secondary" {{ table.attrs.thead.as_html }}>
          <tr>
          {% for column in table.columns %}
            <th {{ column.attrs.th.as_html }}
              {% if column.orderable %}
                hx-get="{% querystring table.prefixed_order_by_field=column.order_by_alias.next %}"
                hx-trigger="click"
                hx-target="div.table-body-container"
                hx-swap="outerHTML"
                hx-push-url="true"
                hx-boost="true"
                class="cursor-pointer"
              {% endif %}
            >
              <div class="relative flex justify-center items-center">
                <div class="mx-8">{{ column.header }}</div>
                <div class="absolute right-1">
                {% if column.orderable %}
                    <svg class="feather !size-3 !stroke-none {% if column.is_ordered and column.order_by_alias.is_descending %}text-hl-primary !fill-hl-primary{% else %}!fill-text-primary {% endif %}"><use href="{% static 'icons/feather-sprite.svg#triangle' %}" /></svg>
                    <svg class="feather !size-3 !stroke-none rotate-180 {% if column.is_ordered and column.order_by_alias.is_ascending %}text-hl-primary !fill-hl-primary{% else %}!fill-text-primary {% endif %}"><use href="{% static 'icons/feather-sprite.svg#triangle' %}" /></svg>
                {% endif %}
                </div>
              </div>
            </th>
          {% endfor %}
          </tr>
        </thead>
    {% endif %}
    {% endblock table.thead %}
    {% block table.tbody %}
      <tbody class="group-has-[.htmx-request]/loading:saturate-[75%] group-has-[.htmx-request]/loading:opacity-80 transition-all duration-500 ease-in-out">
      {% include "tables/table_body_partial.html" %}
      </tbody>
    {% endblock table.tbody %}
    {% block table.tfoot %}
    {% if table.has_footer %}
    <tfoot {{ table.attrs.tfoot.as_html }}>
      <tr>
      {% for column in table.columns %}
        <td {{ column.attrs.tf.as_html }}>{{ column.footer }}</td>
      {% endfor %}
      </tr>
    </tfoot>
    {% endif %}
    {% endblock table.tfoot %}
  </table>
  {% endblock table %}

  {% if table.page and table.paginator.num_pages > 1 %}
  {% include "tables/table_pagination.html" with table_page_range=table_page_range %}
  {% endif %}
  {% if table.paginator and table.paginator.num_pages > 1 and not request.GET.show_all_rows and query.GET.q != '' %}
  <button class="group/spinner flex justify-center p-2 bg-bg-tertiary border-2 border-x-bg-tertiary border-y-hl-tertiary font-mono hover:bg-hl-tertiary hover:font-bold hover:text-black text-xl"
    hx-get=""
    hx-include="[name='show_all_rows']"
    hx-params="*"
    hx-push-url="true"
    hx-trigger="click"
    hx-swap="outerHTML"
    hx-target="div.table-body-container"
  >
    <div class="flex items-center gap-4">
      <div class="show-more-button-text">Show more rows</div>
      {% include "atoms/htmx/spinner.html" %}
    </div>
    <input type="hidden" name="show_all_rows" value="1"/>
  </button>
  {% endif %}
</div>
{% endblock table_wrapper %}
